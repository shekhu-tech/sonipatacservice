<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SonipatHomeService.com - Normal PCB Repair Service</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        /* CSS is unchanged */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        :root {
            --primary: #0066cc;
            --secondary: #0099ff;
            --accent: #00ccff;
            --light: #f5f5f5;
            --dark: #212121;
            --success: #4caf50;
            --warning: #ff9800;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        body {
            background: linear-gradient(135deg, #003366 0%, #006699 100%);
            color: var(--light);
            line-height: 1.6;
            overflow-x: hidden;
        }
        main {
            padding-top: 6rem;
            max-width: 1700px;
            margin: 0 auto;
            padding: 6rem 1rem 3rem;
        }
        .lottery-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.625rem;
            padding: 1rem;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: var(--transition);
            border: 1px solid rgba(0, 153, 255, 0.2);
        }
        .stat-card:hover {
            transform: translateY(-0.3125rem);
            box-shadow: var(--shadow);
            border-color: var(--secondary);
        }
        .stat-card h3 {
            font-size: 0.95rem;
            margin-bottom: 0.3rem;
            color: #00ccff;
        }
        .stat-card p {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--light);
        }
        .product-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.9375rem;
            overflow: hidden;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 153, 255, 0.2);
        }
        .product-header {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            padding: 1.25rem;
            text-align: center;
        }
        .product-header h2 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }
        .product-content {
            display: flex;
            flex-wrap: wrap;
            padding: 1.5rem;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
        }
        .product-image {
            flex: 1;
            min-width: 280px;
            max-width: 100%;
            height: auto;
            border-radius: 0.625rem;
            overflow: hidden;
            background: url('https://placehold.co/600x400/0066cc/ffffff?text=Normal+PCB+Repair') no-repeat center center;
            background-size: cover;
            min-height: 250px;
        }
        .product-details {
            flex: 2;
            min-width: 280px;
            padding: 1rem;
        }
        .price-container {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
        }
        .original-price {
            font-size: 1.5rem;
            text-decoration: line-through;
            color: #b0b0b0;
        }
        .lottery-price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
        }
        .features {
            margin: 1rem 0;
        }
        .features h3 {
            margin-bottom: 0.8rem;
            color: #00ccff;
        }
        .features ul {
            padding-left: 1.2rem;
        }
        .features li {
            margin-bottom: 0.4rem;
            font-size: 0.95rem;
        }
        .action-buttons {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }
        .btn {
            padding: 0.75rem 1.25rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            justify-content: center;
            flex-grow: 1;
            max-width: 100%;
        }
        .btn-primary {
            background: linear-gradient(90deg, var(--accent), #00a8ff);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 204, 255, 0.5);
        }
        .btn-secondary {
            background: transparent;
            color: var(--light);
            border: 2px solid var(--secondary);
        }
        .btn-secondary:hover {
            background: rgba(0, 153, 255, 0.2);
        }
        #popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            z-index: 999;
        }
        .popup {
            display: none;
            background: #002b4d;
            color: #fff;
            padding: 1.5rem;
            border-radius: 1.25rem;
            box-shadow: 0 0 1.875rem rgba(0, 204, 255, 0.5);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            width: 95%;
            max-width: 550px;
            max-height: 95vh;
            overflow-y: auto;
            animation: fadeIn 0.3s ease-out forwards;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -45%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }
        .popup input,
        .popup button,
        .popup select,
        .popup textarea {
            width: 100%;
            padding: 0.75rem;
            margin: 0.625rem 0;
            border-radius: 0.625rem;
            border: none;
            font-size: 1rem;
        }
        .popup input,
        .popup textarea {
            background: #f5f5f5;
            color: #000;
        }
        .popup textarea {
            min-height: 6.25rem;
            resize: vertical;
        }
        .popup label {
            display: block;
            margin-bottom: 0.3125rem;
            color: #00ccff;
            font-size: 0.95rem;
        }
        .popup button[type="submit"],
        .popup button#okayBtn,
        #razorpay-payment-btn,
        #downloadTicketsBtn {
            background: linear-gradient(90deg, var(--accent), #00a8ff);
            color: white;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            padding: 0.75rem;
            margin-top: 0.9375rem;
            border-radius: 0.625rem;
            border: none;
            font-size: 1rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .popup button[type="submit"]:hover,
        .popup button#okayBtn:hover,
        #razorpay-payment-btn:hover,
        #downloadTicketsBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 204, 255, 0.5);
        }
        #ticketDisplay {
            font-weight: bold;
            color: #00ffcc;
            font-size: 1.1rem;
            word-break: break-word;
            text-align: center;
            max-height: 12.5rem;
            overflow-y: auto;
            padding: 0.625rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0.625rem;
            margin: 0.625rem 0;
        }
        #countryError {
            color: red;
            font-size: 0.8rem;
            display: none;
            margin-top: -0.3125rem;
            margin-bottom: 0.625rem;
        }
        #submitMessage {
            color: #00ffcc;
            font-size: 1rem;
            text-align: center;
            margin-top: 0.625rem;
            display: none;
        }
        #timerDisplay {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--accent);
            text-align: center;
            margin-top: 0.9375rem;
        }
        .quantity-selector {
            margin: 0.9375rem 0;
        }
        .quantity-selector label {
            display: block;
            margin-bottom: 0.5rem;
            color: #00ccff;
        }
        .quantity-info {
            display: flex;
            justify-content: space-between;
            margin-top: 0.3125rem;
            font-size: 0.85rem;
            color: #ccc;
        }
        .total-price {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--accent);
            text-align: right;
            margin: 0.625rem 0;
        }
        .custom-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #00a8ff;
            color: white;
            padding: 1.25rem 1.875rem;
            border-radius: 0.625rem;
            z-index: 1002;
            box-shadow: 0 0.3125rem 0.9375rem rgba(0, 0, 0, 0.4);
            font-size: 1rem;
            text-align: center;
            max-width: 90%;
            animation: fadeInOut 4s forwards;
        }
        @keyframes fadeInOut {
            0% {
                opacity: 0;
                transform: translate(-50%, -40%);
            }
            10% {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
            90% {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -60%);
                display: none;
            }
        }
        @media (max-width: 1024px) {
            main {
                padding: 5rem 1rem 2rem;
            }
            .product-header h2 {
                font-size: 1.5rem;
            }
            .product-content {
                flex-direction: column;
                padding: 1rem;
            }
            .product-image {
                min-height: 200px;
                width: 100%;
            }
            .product-details {
                min-width: unset;
                width: 100%;
                text-align: center;
            }
            .price-container,
            .action-buttons {
                justify-content: center;
            }
            .btn {
                width: 100%;
                max-width: 300px;
            }
            .lottery-stats {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
            .stat-card {
                padding: 0.8rem;
            }
            .stat-card h3 {
                font-size: 0.85rem;
            }
            .stat-card p {
                font-size: 1.3rem;
            }
            .popup {
                padding: 1rem;
            }
            .popup input,
            .popup button,
            .popup select,
            .popup textarea {
                font-size: 0.9rem;
                padding: 0.6rem;
            }
        }
        @media (max-width: 768px) {
            main {
                padding-top: 4rem;
            }
            .product-header h2 {
                font-size: 1.3rem;
            }
            .original-price {
                font-size: 1.3rem;
            }
            .lottery-price {
                font-size: 1.8rem;
            }
            .features li {
                font-size: 0.9rem;
            }
            .btn {
                font-size: 0.85rem;
                padding: 0.6rem 1rem;
            }
            .lottery-stats {
                grid-template-columns: 1fr 1fr;
            }
        }
        @media (max-width: 480px) {
            main {
                padding: 3rem 0.5rem 1rem;
            }
            .product-header h2 {
                font-size: 1.2rem;
            }
            .product-content {
                padding: 0.8rem;
            }
            .product-image {
                min-height: 180px;
            }
            .original-price {
                font-size: 1.2rem;
            }
            .lottery-price {
                font-size: 1.6rem;
            }
            .features ul {
                padding-left: 1rem;
            }
            .features li {
                font-size: 0.85rem;
            }
            .action-buttons {
                flex-direction: column;
            }
            .btn {
                width: 100%;
                max-width: unset;
            }
            .lottery-stats {
                grid-template-columns: 1fr;
            }
            .stat-card {
                padding: 0.7rem;
            }
            .stat-card h3 {
                font-size: 0.8rem;
            }
            .stat-card p {
                font-size: 1.1rem;
            }
            .popup {
                padding: 1rem;
                width: 98%;
            }
            .popup h2 {
                font-size: 1.3rem;
            }
            .popup input,
            .popup button,
            .popup select,
            .popup textarea {
                font-size: 0.85rem;
                padding: 0.5rem;
            }
            #ticketDisplay {
                font-size: 0.95rem;
            }
            .custom-alert {
                font-size: 0.9rem;
                padding: 1rem 1.5rem;
            }
        }
    </style>
</head>

<body>

    <main class="container mx-auto px-4 py-8">

        <section class="product-section rounded-2xl shadow-lg mb-8">
            <div class="product-header rounded-t-2xl">
                <h2 class="text-3xl md:text-4xl font-bold text-white">Normal PCB Repair Service</h2>
            </div>

            <div class="product-content flex flex-col md:flex-row items-center justify-center p-6 md:p-8 gap-6">
                <div class="product-details w-full md:w-1/2 lg:w-3/5 text-center md:text-left">
                    <h3 class="text-2xl md:text-3xl font-semibold text-white mb-3">Professional Normal PCB Repair</h3>
                    <p class="text-gray-300 mb-4 text-base md:text-lg">Get expert repair for normal AC PCB issues.
                        Our certified technicians will diagnose and fix common problems with your AC's Printed Circuit Board,
                        restoring its functionality and ensuring smooth operation of your unit.
                    </p>

                    <div class="price-container flex flex-col md:flex-row items-center justify-center md:justify-start gap-4 my-6">
                        <div class="original-price text-gray-400 text-xl md:text-2xl line-through">Market Price: ₹2500</div>
                        <div class="lottery-price text-accent text-3xl md:text-4xl font-bold">Access Fee: ₹1499 per PCB Repair</div>
                    </div>

                    <div class="features text-left my-6">
                        <h3 class="text-xl md:text-2xl font-semibold text-blue-300 mb-3">Service Features:</h3>
                        <ul class="list-disc list-inside text-gray-300 text-base md:text-lg space-y-2">
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Diagnosis of common PCB faults</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Repair of minor PCB components</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Testing of repaired PCB for functionality</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Ensures proper communication between AC components</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>1-month service warranty on repair work</li>
                            <li><i class="fas fa-check-circle text-green-400 mr-2"></i>Excludes major component replacement (e.g., microchip, processor)</li>
                        </ul>
                    </div>

                    <div class="action-buttons flex flex-col sm:flex-row justify-center md:justify-start gap-4 mt-8">
                        <button class="btn btn-primary shadow-lg hover:shadow-xl" id="participate-btn">
                            <i class="fas fa-microchip"></i> Get PCB Repair
                        </button>
                        <button class="btn btn-secondary shadow-lg hover:shadow-xl" onclick="window.open('index.html')">
                            <i class="fas fa-external-link-alt"></i> Go Back To Home
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <div class="lottery-stats grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="stat-card rounded-xl shadow-lg">
                <h3 class="text-blue-300 text-lg font-medium mb-1">Total Members</h3>
                <p class="text-white text-3xl font-bold">28,500+</p>
            </div>
            <div class="stat-card rounded-xl shadow-lg">
                <h3 class="text-blue-300 text-lg font-medium mb-1">Recent Repairs</h3>
                <p class="text-white text-3xl font-bold">300 Completed</p>
            </div>
            <div class="stat-card rounded-xl shadow-lg">
                <h3 class="text-blue-300 text-lg font-medium mb-1">Member Savings</h3>
                <p class="text-white text-3xl font-bold">Up to 80%</p>
            </div>
            <div class="stat-card rounded-xl shadow-lg">
                <h3 class="text-blue-300 text-lg font-medium mb-1">Next Allocation</h3>
                <p class="text-white text-3xl font-bold">August 20</p>
            </div>
        </div>
    </main>

    <div id="popup-overlay"></div>

    <div class="popup" id="popupForm">
        <h2 class="text-2xl font-bold text-center mb-4">Normal PCB Repair Service</h2>
        <form id="lotteryForm">
            <label for="fullName" class="text-blue-300 text-sm mb-1">Your Full Name (min 10 characters)</label>
            <input type="text" id="fullName" name="field1" required placeholder="John Doe" autocomplete="name" minlength="10" class="rounded-lg bg-gray-100 text-gray-900 p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500" />

            <label for="phone" class="text-blue-300 text-sm mb-1">Phone Number (10 digits)</label>
            <input type="tel" id="phone" name="field2" required placeholder="9876543210" autocomplete="tel" pattern="[0-9]{10}" class="rounded-lg bg-gray-100 text-gray-900 p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500" />

            <label for="email" class="text-blue-300 text-sm mb-1">Email Address</label>
            <input type="email" id="email" name="field3" required placeholder="john.doe@example.com" autocomplete="email" class="rounded-lg bg-gray-100 text-gray-900 p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500" />

            <div class="mb-3">
                <label for="dobField" class="text-blue-300 text-sm mb-1">Date of Birth:</label>
                <input type="date" id="dobField" name="field4" required class="rounded-lg bg-gray-100 text-gray-900 p-3 w-full focus:outline-none focus:ring-2 focus:ring-blue-500" />
            </div>

            <label for="location" class="text-blue-300 text-sm mb-1">Your Location (e.g. Sonipat, Delhi)</label>
            <input type="text" id="location" name="field5" required placeholder="Sonipat" autocomplete="address-level2" list="locations" class="rounded-lg bg-gray-100 text-gray-900 p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500" />

            <label for="address" class="text-blue-300 text-sm mb-1">Complete Address (min 30 characters)</label>
            <textarea id="address" name="field6" required placeholder="House No, Street, Area, Landmark, City, State, PIN code" autocomplete="street-address" minlength="30" rows="4" class="rounded-lg bg-gray-100 text-gray-900 p-3 w-full mb-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
            <span id="countryError" class="text-red-400 text-xs mt-1 hidden">Please enter your complete address with at least 30 characters.</span>

            <div class="quantity-selector my-4">
                <label for="ticketQuantity" class="text-blue-300 text-sm mb-2">Number of PCB Repairs (Max 5):</label>
                <select id="ticketQuantity" name="ticketQuantity" required class="rounded-lg bg-gray-100 text-gray-900 p-3 w-full focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" disabled selected>Select quantity</option>
                </select>
                <div class="quantity-info flex justify-between mt-2 text-gray-400 text-sm">
                    <span>₹1499 per Repair</span>
                    <span class="total-price font-bold text-accent text-lg">Total: ₹0</span>
                </div>
            </div>

            <input type="hidden" name="ticket" id="ticketCode" />
            <button type="submit" class="w-full btn-primary mt-4 py-3 rounded-xl font-bold text-white text-lg transition-all duration-300 hover:scale-105 hover:shadow-xl">Submit Details</button>
            <span id="submitMessage" class="text-green-400 text-center mt-3 hidden">Submitting... Please wait</span>
        </form>
    </div>

    <div class="popup" id="paymentStep">
        <h2 class="text-2xl font-bold text-center mb-4">Complete Your Payment for PCB Repair</h2>
        <p class="text-gray-300 text-center mb-6">Please complete the payment to finalize your PCB Repair purchase. Click the button below.</p>
        <div id="paymentSummary" class="bg-gray-800 p-4 rounded-lg mb-6 text-center"></div>
        <div id="timerDisplay" class="text-accent text-xl font-bold text-center mb-6">Time remaining: 05:00</div>
        <button id="razorpay-payment-btn" class="w-full btn-primary py-3 rounded-xl font-bold text-white text-lg transition-all duration-300 hover:scale-105 hover:shadow-xl">Pay with Razorpay</button>
        <p class="mt-4 text-sm text-gray-400 text-center">
            After payment, please wait for automatic verification. Do not close this window.
        </p>
    </div>

    <div class="popup" id="ticketStep">
        <h2 id="welcomeMessage" class="text-2xl font-bold text-center mb-4 text-green-400"></h2>
        <p class="text-gray-300 text-center mb-4">You have successfully booked <span id="ticketCountDisplay" class="font-bold text-blue-300"></span>:</p>
        <div id="ticketDisplay" class="bg-gray-800 p-4 rounded-lg mb-6 text-center text-lg"></div>
        <button id="downloadTicketsBtn" class="w-full btn-primary py-3 rounded-xl font-bold text-white text-lg transition-all duration-300 hover:scale-105 hover:shadow-xl">
            <i class="fas fa-download mr-2"></i> Download Repair Details
        </button>
        <p class="mt-4 text-sm text-gray-400 text-center">📸 Please take a screenshot for proof and reference.</p>
        <button id="okayBtn" class="w-full btn-secondary py-3 rounded-xl font-bold text-white text-lg mt-4 transition-all duration-300 hover:scale-105 hover:bg-opacity-20">Okay, Got It!</button>
    </div>

    <script>
        // Popup Elements
        const participateBtn = document.getElementById('participate-btn');
        const popupOverlay = document.getElementById('popup-overlay');
        const allPopups = document.querySelectorAll('.popup');
        const popupForm = document.getElementById('popupForm');
        const paymentStep = document.getElementById('paymentStep');
        const ticketStep = document.getElementById('ticketStep');
        const timerDisplay = document.getElementById('timerDisplay');
        const razorpayBtn = document.getElementById('razorpay-payment-btn');
        const submitMessage = document.getElementById('submitMessage');
        const ticketQuantity = document.getElementById('ticketQuantity');
        const totalPriceDisplay = document.querySelector('.total-price');
        const paymentSummary = document.getElementById('paymentSummary');
        const ticketCountDisplay = document.getElementById('ticketCountDisplay');
        const downloadTicketsBtn = document.getElementById('downloadTicketsBtn');
        const welcomeMessage = document.getElementById('welcomeMessage');

        // Form & Ticket Elements
        const form = document.getElementById('lotteryForm');
        const ticketInput = document.getElementById('ticketCode');
        const ticketDisplay = document.getElementById('ticketDisplay');
        const okayBtn = document.getElementById('okayBtn');

        let generatedTicket = '';
        let paymentTimeout = null;
        let countdownInterval = null;
        const PAYMENT_TIME_LIMIT = 5 * 60;
        const TICKET_PRICE = 1499;
        let selectedQuantity = 1;
        let allowClose = false;

        function initQuantitySelector() {
            const maxTickets = 5;
            ticketQuantity.innerHTML = '<option value="" disabled selected>Select quantity</option>';
            for (let i = 1; i <= maxTickets; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i + (i === 1 ? ' repair' : ' repairs');
                ticketQuantity.appendChild(option);
            }
            ticketQuantity.value = 1;
            updateTotalPrice();
        }

        function updateTotalPrice() {
            selectedQuantity = parseInt(ticketQuantity.value) || 1;
            const total = selectedQuantity * TICKET_PRICE;
            totalPriceDisplay.textContent = `Total: ₹${total}`;
        }

        function generateFormattedTicket() {
            const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0,
                    v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
            return uuid.toUpperCase().replace(/-/g, '').match(/.{1,4}/g).join('-');
        }

        function downloadTickets() {
            const ticketContent = `Normal PCB Repair Booking Details\n\n` +
                `Customer Name: ${form.field1.value}\n` +
                `Contact: ${form.field2.value}\n` +
                `Location: ${form.field5.value}\n` +
                `Booking Reference Number: ${generatedTicket}\n\n` +
                `Total Repairs: ${selectedQuantity}\n` +
                `Total Amount Paid: ₹${selectedQuantity * TICKET_PRICE}`;
            const blob = new Blob([ticketContent], {
                type: 'text/plain'
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'normal_pcb_repair_booking.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function closeAllPopups() {
            if (!allowClose) return;
            clearTimers();
            popupOverlay.style.display = 'none';
            allPopups.forEach(p => p.style.display = 'none');
            document.body.style.overflow = 'auto';
            submitMessage.style.display = 'none';
            allowClose = false;
        }

        function openPopup(popupElement) {
            document.body.style.overflow = 'hidden';
            popupOverlay.style.display = 'block';
            popupElement.style.display = 'block';
            allowClose = false;
        }

        function clearTimers() {
            if (paymentTimeout) clearTimeout(paymentTimeout);
            if (countdownInterval) clearInterval(countdownInterval);
            paymentTimeout = null;
            countdownInterval = null;
        }

        participateBtn.addEventListener('click', () => {
            initQuantitySelector();
            openPopup(popupForm);
        });

        ticketQuantity.addEventListener('change', updateTotalPrice);

        popupOverlay.addEventListener('click', function(e) {
            if (allowClose) {
                closeAllPopups();
            } else {
                showCustomAlert("Please complete the form or payment process before closing.");
            }
        });

        allPopups.forEach(p => p.addEventListener('click', e => e.stopPropagation()));

        okayBtn.addEventListener('click', function() {
            window.location.href = 'index.html';
        });

        razorpayBtn.addEventListener('click', handleRazorpayPayment);
        downloadTicketsBtn.addEventListener('click', downloadTickets);

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const fullName = form.fullName.value.trim();
            const phone = form.phone.value.trim();
            const email = form.email.value.trim();
            const dob = form.dobField.value;
            const location = form.location.value.trim();
            const address = form.address.value.trim();

            if (fullName.length < 10) {
                showCustomAlert("Please enter your full name (minimum 10 characters)");
                return;
            }
            if (!/^\d{10}$/.test(phone)) {
                showCustomAlert("Please enter a valid 10-digit phone number");
                return;
            }
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showCustomAlert("Please enter a valid email address");
                return;
            }
            if (!dob) {
                showCustomAlert("Please select your date of birth");
                return;
            }
            if (location.length < 3) {
                showCustomAlert("Please enter a valid location name");
                return;
            }
            if (address.length < 30) {
                document.getElementById('countryError').style.display = 'block';
                showCustomAlert("Please enter a complete address with at least 30 characters.");
                return;
            }
            document.getElementById('countryError').style.display = 'none';

            submitMessage.style.display = 'block';
            form.querySelector('button[type="submit"]').disabled = true;
            generatedTicket = generateFormattedTicket(fullName, phone, email, dob, location, address);

            const formData = new FormData(form);
            formData.set('field1', fullName);
            formData.set('field2', phone);
            formData.set('field3', email);
            formData.set('field4', dob);
            formData.set('field5', location);
            formData.set('field6', address);
            formData.set('ticket', generatedTicket);
            formData.set('tab', "normal-pcb-repair");
            formData.set('serviceType', 'Professional Normal PCB Repair');
            formData.set('ticketQuantity', selectedQuantity);

            fetch(
                "https://script.google.com/macros/s/AKfycbxx5AVVkC_cC3Hn4b4Sl3R0Hk7t32NzC_Rkg3nlR3REVm-m0T-tDoHjTUat_Usy_0GP/exec", {
                    method: "POST",
                    body: formData,
                }
            ).then(res => res.text()).then(res => {
                submitMessage.style.display = 'none';
                form.querySelector('button[type="submit"]').disabled = false;
                if (res === "Success") {
                    popupForm.style.display = 'none';
                    openPopup(paymentStep);
                    paymentSummary.innerHTML = `
                        <p class="text-gray-300 text-lg mb-2">You are purchasing <span class="font-bold text-blue-300">${selectedQuantity}</span> Normal PCB Repair${selectedQuantity > 1 ? 's' : ''} at ₹${TICKET_PRICE} each</p>
                        <p class="total-price text-accent text-2xl font-bold">Total Amount: ₹${selectedQuantity * TICKET_PRICE}</p>
                    `;
                    startPaymentTimer();
                } else {
                    console.error("Submission failed: " + res);
                    showCustomAlert("There was an error submitting your form. Please try again.");
                }
            }).catch(err => {
                submitMessage.style.display = 'none';
                form.querySelector('button[type="submit"]').disabled = false;
                console.error("An unexpected error occurred. Please check your connection and try again:", err);
                showCustomAlert("An unexpected error occurred. Please check your connection and try again.");
            });
        });

        function showCustomAlert(message) {
            const alertBox = document.createElement('div');
            alertBox.className = 'custom-alert';
            alertBox.textContent = message;
            document.body.appendChild(alertBox);
            setTimeout(() => {
                alertBox.remove();
            }, 4000);
        }

        function handleRazorpayPayment() {
            const totalAmount = selectedQuantity * TICKET_PRICE * 100;
            const options = {
                "key": "rzp_live_opiqkRmGpjG1hF",
                "amount": totalAmount.toString(),
                "currency": "INR",
                "name": document.querySelector('.product-header h2').textContent,
                "description": `Payment for ${selectedQuantity} Normal PCB Repair${selectedQuantity > 1 ? 's' : ''}`,
                "image": "https://placehold.co/100x100/0066cc/ffffff?text=CA",
                "handler": function(response) {
                    console.log("Payment successful:", response);
                    console.log("Razorpay Payment ID:", response.razorpay_payment_id);
                    paymentSuccess();
                },
                "prefill": {
                    "name": form.field1.value,
                    "email": form.field3.value,
                    "contact": form.field2.value
                },
                "notes": {
                    "address": `${form.field5.value}, ${form.field6.value}`,
                    "repair_count": selectedQuantity.toString()
                },
                "theme": {
                    "color": "#0066cc"
                },
                "modal": {
                    "ondismiss": function() {
                        console.log('Razorpay checkout modal closed.');
                    }
                }
            };
            const rzp1 = new Razorpay(options);
            rzp1.on('payment.failed', function(response) {
                console.error("Payment Failed:", response.error);
                showCustomAlert(`Payment Failed: ${response.error.description} (Code: ${response.error.code})`);
            });
            rzp1.open();
        }

        function startPaymentTimer() {
            let timeLeft = PAYMENT_TIME_LIMIT;
            updateTimerDisplay();
            function updateTimerDisplay() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `Time remaining: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            countdownInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    showCustomAlert("Payment time expired. Please try again.");
                    allowClose = true;
                    closeAllPopups();
                }
            }, 1000);
            paymentTimeout = setTimeout(() => {
                if (paymentTimeout) {
                    clearTimers();
                    showCustomAlert("Payment timed out. Please try again.");
                    allowClose = true;
                    closeAllPopups();
                }
            }, PAYMENT_TIME_LIMIT * 1000);
        }

        function paymentSuccess() {
            clearTimers();
            paymentStep.style.display = 'none';
            openPopup(ticketStep);
            const userName = form.fullName.value;
            welcomeMessage.textContent = `🎉 Congratulations, ${userName}! Your Normal PCB Repair Booking is Confirmed! 🎉`;
            ticketDisplay.innerHTML = `
                <p>Registration ID: <span class="text-white">${generatedTicket}</span></p>
                <p>Normal PCB Repair Count: <span class="text-white">${selectedQuantity}</span></p>
            `;
            ticketCountDisplay.textContent = `${selectedQuantity} Normal PCB Repair${selectedQuantity > 1 ? 's' : ''}`;
            allowClose = true;
        }

        const hamburger = document.querySelector('.hamburger');
        const navLinks = document.querySelector('.nav-links');
        if (hamburger && navLinks) {
            hamburger.addEventListener('click', () => {
                navLinks.classList.toggle('active');
            });
        }
    </script>
    <script src="script.js" defer></script>
</body>
</html>
